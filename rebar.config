{erl_opts, [debug_info]}.

{deps, [
    {gpb, "4.21.7"},
    {erlcloud, "3.8.3"}
]}.

{plugins, [
    {rebar3_gpb_plugin, "2.23.8"}   % hooks gpb compilation into rebar3 compile
]}.

% Options passed to the gpb compiler
{gpb_opts, [
    {i, "priv"},                    % find .proto files in priv/
    {module_name_suffix, "_pb"},    % kv.proto produces kv_pb module
    {strings_as_binaries, true},    % decode string fields as binaries (<<...>>), not char lists
    {include_as_lib, true}          % use -include_lib("gpb/include/gpb.hrl") instead of -include("gpb.hrl")
]}.

% Run proto compilation before Erlang compilation, and clean proto artifacts on clean
{provider_hooks, [
    {pre,  [{compile, {protobuf, compile}}]},
    {post, [{clean,   {protobuf, clean}}]}
]}.

{relx, [
    {release, {gpb_over_tcp_erl, "0.1.0"}, [
        gpb_over_tcp_erl,
        sasl
    ]},
    {sys_config, "config/sys.config.src"},
    {extended_start_script, true}
]}.

{shell, [
    {apps, [gpb_over_tcp_erl]},
    {config, "config/sys.config"}
]}.

{profiles, [
    {prod, [
        {relx, [
            {mode, prod}
        ]}
    ]},
    {test, [
        {deps, [{meck, "0.9.2"}]}
    ]}
]}.
